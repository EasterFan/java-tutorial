(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{273:function(a,t,s){"use strict";s.r(t);var n=s(2),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"zipkin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zipkin"}},[a._v("#")]),a._v(" Zipkin")]),a._v(" "),s("p",[a._v("Zipkin 是一个基于 Java 开发的分布式跟踪系统。它采集有助于解决服务架构中延迟问题的实时数据。其核心功能是采集和查找数据。")]),a._v(" "),s("h2",{attrs:{id:"zipkin-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zipkin-简介"}},[a._v("#")]),a._v(" Zipkin 简介")]),a._v(" "),s("h3",{attrs:{id:"特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[a._v("#")]),a._v(" 特性")]),a._v(" "),s("p",[a._v("如果日志文件中有跟踪 ID，则可以直接跳至该跟踪 ID。 否则，您可以基于属性进行查询，例如服务，操作名称，标签和持续时间。 将为您总结一些有趣的数据，例如在服务中花费的时间百分比以及操作是否失败。")]),a._v(" "),s("p",[a._v("Zipkin UI 还提供了一个依赖关系图，该关系图显示了每个应用程序中跟踪了多少个请求。这对于识别聚合行为（包括错误路径或对不赞成使用的服务的调用）很有帮助。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/snap/20200211161706.png",alt:"Zipkin UI"}})]),a._v(" "),s("h3",{attrs:{id:"多平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多平台"}},[a._v("#")]),a._v(" 多平台")]),a._v(" "),s("p",[a._v("Zipkin 官方支持 C#、Go、Java、JavaScript、Ruby、Scala、PHP 语言。")]),a._v(" "),s("p",[a._v("除此以外，社区还贡献了多种其他语言的支持，详情可以参考官方文档："),s("a",{attrs:{href:"https://zipkin.io/pages/tracers_instrumentation.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Tracers and Instrumentation"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据"}},[a._v("#")]),a._v(" 数据")]),a._v(" "),s("p",[a._v("Zipkin 服务器捆绑了用于采集和存储数据的扩展。")]),a._v(" "),s("p",[a._v("默认情况下，数据可以通过 "),s("code",[a._v("Http")]),a._v("，"),s("code",[a._v("Kafka")]),a._v(" 、"),s("code",[a._v("RabbitMQ")]),a._v(" 或 RPC 传输。")]),a._v(" "),s("p",[a._v("并存储在内存中或 "),s("code",[a._v("MySQL")]),a._v("、"),s("code",[a._v("Cassandra")]),a._v(" 或 "),s("code",[a._v("Elasticsearch")]),a._v(" 中。")]),a._v(" "),s("p",[a._v("数据以 json 形式存储，可以参考："),s("a",{attrs:{href:"https://zipkin.io/zipkin-api/#/default/post_spans",target:"_blank",rel:"noopener noreferrer"}},[a._v("Zipkin 官方的 Swagger API"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/snap/20200211162055.png",alt:"Zipkin Swagger API"}})]),a._v(" "),s("h2",{attrs:{id:"zipkin-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zipkin-安装"}},[a._v("#")]),a._v(" Zipkin 安装")]),a._v(" "),s("h3",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[a._v("#")]),a._v(" Docker")]),a._v(" "),s("p",[a._v("Docker 启动方式：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("docker run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9411")]),a._v(":9411 openzipkin/zipkin\n")])])]),s("h3",{attrs:{id:"java"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java"}},[a._v("#")]),a._v(" Java")]),a._v(" "),s("blockquote",[s("p",[a._v("注意：必须运行在 JDK8+ 环境")])]),a._v(" "),s("p",[a._v("Java 启动方式：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -sSL https://zipkin.io/quickstart.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" -s\njava -jar zipkin.jar\n")])])]),s("h3",{attrs:{id:"编译方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译方式"}},[a._v("#")]),a._v(" 编译方式")]),a._v(" "),s("p",[a._v("适用于需要订制化的场景。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# get the latest source")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/openzipkin/zipkin\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" zipkin\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Build the server and also make its dependencies")]),a._v("\n./mvnw -DskipTests --also-make -pl zipkin-server clean "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Run the server")]),a._v("\njava -jar ./zipkin-server/target/zipkin-server-*exec.jar\n")])])]),s("h2",{attrs:{id:"zipkin-架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zipkin-架构"}},[a._v("#")]),a._v(" Zipkin 架构")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/snap/20200211155836.png",alt:"Zipkin 架构"}})]),a._v(" "),s("p",[s("code",[a._v("Tracer")]),a._v(" 存在于你的应用中，它负责采集关于已发生操作的实时元数据。它们通常会检测库，因此对于用户是透明的。例如，已检测的 Web 服务器记录它何时接收到请求，以及何时发送响应。收集的跟踪数据称为跨度（Span）。")]),a._v(" "),s("p",[a._v("Instrumentation 保证了生产环境的安全性和很少的开销。因此，它们仅在内部传播 ID，以告知接收方正在进行追踪。完成的 Span 将通过外部通信告知 Zipkin，类似于应用程序异步报告指标的方式。")]),a._v(" "),s("p",[a._v("例如，当跟踪某个操作并且需要发出 http 请求时，会添加一些 header 来传播 ID。header 不用于发送详细信息，例如操作名称。")]),a._v(" "),s("p",[a._v("能够将数据发送到 Zipkin 的检测应用程序中的组件，被称为 Reporter。Reporter 有多种传输方式，可以将跟踪数据发送到 Zipkin 采集器，后者将跟踪数据持久化保存到存储中。稍后，API 会查询存储以向 UI 提供渲染数据。")]),a._v(" "),s("p",[a._v("以下是 Zipkin 的一个示例工作流：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("┌─────────────┐ ┌───────────────────────┐  ┌─────────────┐  ┌──────────────────┐\n│ User Code   │ │ Trace Instrumentation │  │ Http Client │  │ Zipkin Collector │\n└─────────────┘ └───────────────────────┘  └─────────────┘  └──────────────────┘\n       │                 │                         │                 │\n           ┌─────────┐\n       │ ──┤GET /foo ├─▶ │ ────┐                   │                 │\n           └─────────┘         │ record tags\n       │                 │ ◀───┘                   │                 │\n                           ────┐\n       │                 │     │ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" trace headers │                 │\n                           ◀───┘\n       │                 │ ────┐                   │                 │\n                               │ record timestamp\n       │                 │ ◀───┘                   │                 │\n                             ┌─────────────────┐\n       │                 │ ──┤GET /foo         ├─▶ │                 │\n                             │X-B3-TraceId: aa │     ────┐\n       │                 │   │X-B3-SpanId: 6b  │   │     │           │\n                             └─────────────────┘         │ invoke\n       │                 │                         │     │ request   │\n                                                         │\n       │                 │                         │     │           │\n                                 ┌────────┐          ◀───┘\n       │                 │ ◀─────┤200 OK  ├─────── │                 │\n                           ────┐ └────────┘\n       │                 │     │ record duration   │                 │\n            ┌────────┐     ◀───┘\n       │ ◀──┤200 OK  ├── │                         │                 │\n            └────────┘       ┌────────────────────────────────┐\n       │                 │ ──┤ asynchronously report span     ├────▶ │\n                             │                                │\n                             │"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("                               │\n                             │  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"traceId"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"aa"')]),a._v(",              │\n                             │  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"id"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"6b"')]),a._v(",                   │\n                             │  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"name"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"get"')]),a._v(",                │\n                             │  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1483945573944000")]),a._v(",│\n                             │  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"duration"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("386000")]),a._v(",           │\n                             │  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"annotations"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("              │\n                             │--snip--                        │\n                             └────────────────────────────────┘\n")])])]),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://zipkin.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Zipkin 官网"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/openzipkin/zipkin",target:"_blank",rel:"noopener noreferrer"}},[a._v("Zipkin Github"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);